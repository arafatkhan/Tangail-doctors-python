{% extends "doctors/base.html" %}
{% load i18n %}

{% block title %}üö® {% trans "‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞" %} - {% trans "‡¶ü‡¶æ‡¶ô‡ßç‡¶ó‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ" %}{% endblock %}

{% block content %}

<div class="text-center mb-4 p-4" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;border-radius:10px;">
    <h1 class="display-4"><i class="fas fa-ambulance me-3"></i>üö® {% trans "‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞" %}</h1>
    <p class="lead mb-0">{% trans "‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶∏‡ßá‡¶¨‡¶æ - ‡¶è‡¶ñ‡¶®‡¶á ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá" %}</p>
</div>

<!-- Emergency Filters -->
<div class="card mb-4 shadow-sm">
    <div class="card-body">
        <div class="row g-3 align-items-center">
            <div class="col-md-6">
                <form method="get" class="d-flex">
                    <input type="text" name="search" value="{{ search_query }}" 
                           class="form-control me-2" placeholder="{% trans '‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...' %}">
                    <input type="hidden" name="filter" value="{{ filter_type }}">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> {% trans "‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®" %}
                    </button>
                </form>
            </div>
            <div class="col-md-6">
                <div class="btn-group w-100" role="group">
                    <a href="?filter=all{% if search_query %}&search={{ search_query }}{% endif %}" 
                       class="btn {% if filter_type == 'all' %}btn-danger{% else %}btn-outline-danger{% endif %}">
                        <i class="fas fa-ambulance"></i> {% trans "‡¶∏‡¶¨ ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø" %}
                    </a>
                    <a href="?filter=emergency{% if search_query %}&search={{ search_query }}{% endif %}" 
                       class="btn {% if filter_type == 'emergency' %}btn-danger{% else %}btn-outline-danger{% endif %}">
                        üö® {% trans "‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶∏‡ßá‡¶¨‡¶æ" %}
                    </a>
                    <a href="?filter=24_7{% if search_query %}&search={{ search_query }}{% endif %}" 
                       class="btn {% if filter_type == '24_7' %}btn-warning{% else %}btn-outline-warning{% endif %}">
                        üïê {% trans "‡ß®‡ß™/‡ß≠ ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß" %}
                    </a>
                </div>
            </div>
        </div>
        
        {% if total_count %}
        <div class="mt-3 text-center">
            <div class="badge bg-info">{% blocktrans with count=total_count %}‡¶Æ‡ßã‡¶ü {{ count }} ‡¶ú‡¶® ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá{% endblocktrans %}</div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Emergency Instructions -->
<div class="alert alert-info mb-4">
    <h6><i class="fas fa-info-circle me-2"></i>{% trans "‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßá" %}:</h6>
    <ul class="mb-0">
        <li>{% trans "‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®" %}</li>
        <li>{% trans '"‡¶è‡¶ñ‡¶®‡¶á ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶´‡ßã‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®' %}</li>
        <li>{% trans "WhatsApp ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá‡¶ì ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®" %}</li>
        <li>{% trans "‡¶ú‡ßÄ‡¶¨‡¶®‡ßá‡¶∞ ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á 999 ‡¶è ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡ßç‡¶¨‡ßÅ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶°‡¶æ‡¶ï‡ßÅ‡¶®" %}</li>
    </ul>
</div>

<!-- Doctors List -->
<div class="row">
    {% if doctors %}
        {% for doctor in doctors %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 shadow-sm" style="border:2px solid {% if doctor.is_emergency_available %}#dc3545{% else %}#ffc107{% endif %};">
                <div class="card-body">
                    <!-- Emergency Badges -->
                    <div class="mb-3">
                        {% if doctor.is_emergency_available %}
                            <span class="badge bg-danger fs-6">üö® ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶∏‡ßá‡¶¨‡¶æ ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß</span>
                        {% endif %}
                        {% if doctor.is_24_7_available %}
                            <span class="badge bg-warning text-dark fs-6">üïê ‡ß®‡ß™/‡ß≠</span>
                        {% endif %}
                        {% if doctor.is_available_now %}
                            <span class="badge bg-success fs-6">üü¢ ‡¶è‡¶ñ‡¶® ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß</span>
                        {% endif %}
                    </div>
                    
                    <!-- Doctor Image & Name -->
                    <div class="text-center mb-3">
                        {% if doctor.image %}
                            <img src="{{ doctor.image.url }}" alt="{{ doctor.name }}" 
                                 class="rounded-circle mb-2" 
                                 style="width:100px;height:100px;object-fit:cover;border:3px solid {% if doctor.is_emergency_available %}#dc3545{% else %}#ffc107{% endif %};">
                        {% else %}
                            <div class="rounded-circle d-inline-flex align-items-center justify-content-center mb-2" 
                                 style="width:100px;height:100px;background:#f0f0f0;border:3px solid {% if doctor.is_emergency_available %}#dc3545{% else %}#ffc107{% endif %};">
                                <i class="fas fa-user-md" style="font-size:40px;color:#999;"></i>
                            </div>
                        {% endif %}
                        <h5 class="card-title mb-1">{{ doctor.name }}</h5>
                        <p class="text-muted small">{{ doctor.get_clean_specialty|truncatechars:50 }}</p>
                    </div>
                    
                    <!-- Hospital Info -->
                    <div class="mb-3">
                        <div class="text-muted small mb-1">
                            <i class="fas fa-hospital me-1"></i>{{ doctor.get_clean_hospital|truncatechars:40 }}
                        </div>
                        {% if doctor.view_count %}
                        <div class="text-muted small">
                            <i class="fas fa-eye me-1"></i>{{ doctor.view_count }} ‡¶ú‡¶® ‡¶¶‡ßá‡¶ñ‡ßá‡¶õ‡ßá‡¶®
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Emergency Note -->
                    {% if doctor.emergency_note %}
                    <div class="alert alert-light small mb-3">
                        <i class="fas fa-info-circle me-1"></i>{{ doctor.emergency_note|truncatechars:80 }}
                    </div>
                    {% endif %}
                    
                    <!-- Action Buttons -->
                    <div class="d-grid gap-2">
                        {% if doctor.emergency_phone %}
                        <a href="tel:{{ doctor.emergency_phone }}" class="btn btn-danger btn-lg">
                            <i class="fas fa-phone-alt"></i> ‡¶è‡¶ñ‡¶®‡¶á ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®
                        </a>
                        <div class="row g-2">
                            <div class="col-6">
                                <a href="https://wa.me/88{{ doctor.emergency_phone }}" 
                                   target="_blank"
                                   class="btn btn-success w-100">
                                    <i class="fab fa-whatsapp"></i> WhatsApp
                                </a>
                            </div>
                            <div class="col-6">
                                <a href="{% url 'doctors:detail' doctor.pk %}" 
                                   class="btn btn-outline-primary w-100">
                                    <i class="fas fa-info-circle"></i> ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§
                                </a>
                            </div>
                        </div>
                        {% elif doctor.contact %}
                        <a href="{% url 'doctors:detail' doctor.pk %}" class="btn btn-danger btn-lg">
                            <i class="fas fa-phone-alt"></i> ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                        </a>
                        {% else %}
                        <a href="{% url 'doctors:detail' doctor.pk %}" class="btn btn-primary btn-lg">
                            <i class="fas fa-info-circle"></i> ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="col-12">
            <div class="alert alert-warning text-center">
                <i class="fas fa-exclamation-triangle"></i> 
                ‡¶è‡¶á ‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡ßá‡¶á‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
            </div>
        </div>
    {% endif %}
</div>

<!-- Pagination -->
{% if page_obj %}
<nav aria-label="‡¶™‡ßá‡¶ú‡¶ø‡¶®‡ßá‡¶∂‡¶®" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}&filter={{ filter_type }}">‡¶Ü‡¶ó‡ßá‡¶∞</a>
            </li>
        {% else %}
            <li class="page-item disabled"><span class="page-link">‡¶Ü‡¶ó‡ßá‡¶∞</span></li>
        {% endif %}
        
        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}&filter={{ filter_type }}">{{ num }}</a>
                </li>
            {% endif %}
        {% endfor %}
        
        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}&filter={{ filter_type }}">‡¶™‡¶∞‡ßá‡¶∞</a>
            </li>
        {% else %}
            <li class="page-item disabled"><span class="page-link">‡¶™‡¶∞‡ßá‡¶∞</span></li>
        {% endif %}
    </ul>
</nav>
{% endif %}

<!-- Emergency Contact Info -->
<div class="alert alert-danger text-center mt-5">
    <h5><i class="fas fa-exclamation-triangle me-2"></i>‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</h5>
    <div class="row g-3 mt-2">
        <div class="col-md-4">
            <a href="tel:999" class="btn btn-danger btn-lg w-100">
                <i class="fas fa-ambulance"></i> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡ßç‡¶¨‡ßÅ‡¶≤‡ßá‡¶®‡ßç‡¶∏: 999
            </a>
        </div>
        <div class="col-md-4">
            <a href="tel:102" class="btn btn-danger btn-lg w-100">
                <i class="fas fa-hospital"></i> ‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤: 102
            </a>
        </div>
        <div class="col-md-4">
            <a href="tel:100" class="btn btn-danger btn-lg w-100">
                <i class="fas fa-shield-alt"></i> ‡¶™‡ßÅ‡¶≤‡¶ø‡¶∂: 100
            </a>
        </div>
    </div>
</div>

{% endblock %}
